

**Prometheus** ‚Äî —ç—Ç–æ **—Å–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –æ–ø–æ–≤–µ—â–µ–Ω–∏—è —Å –æ—Ç–∫—Ä—ã—Ç—ã–º –∏—Å—Ö–æ–¥–Ω—ã–º –∫–æ–¥–æ–º**, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è –≤ SoundCloud –∏ –Ω—ã–Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–∞—è **Cloud Native Computing Foundation (CNCF)** (–≤–º–µ—Å—Ç–µ —Å Kubernetes, Helm –∏ –¥—Ä—É–≥–∏–º–∏ –ø—Ä–æ–µ–∫—Ç–∞–º–∏).  
–û–Ω –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è **—Å–±–æ—Ä–∞, —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –∞–Ω–∞–ª–∏–∑–∞ –º–µ—Ç—Ä–∏–∫** —Å —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å–∏—Å—Ç–µ–º –∏ —Å–µ—Ä–≤–∏—Å–æ–≤.

Prometheus ‚Äî –∫–ª—é—á–µ–≤–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≤ **–æ–±—Å–µ—Ä–≤–∞–±–∏–ª–∏—Ç–∏-—Å—Ç–µ–∫–µ** (observability stack), –∫–æ—Ç–æ—Ä—ã–π —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å **[[Grafana]]**, **[[Alertmanager]]** –∏ **exporter‚Äô–∞–º–∏**.

##  –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ Prometheus

### 1. **–ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö**

Prometheus —Ö—Ä–∞–Ω–∏—Ç **–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä—è–¥—ã** (_time series_):

```
<metric_name>{label1="value1", label2="value2"} value @timestamp
```

 –ü—Ä–∏–º–µ—Ä:

```
http_requests_total{method="GET", handler="/api"} 1234
```

‚Üí 1234 GET-–∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ `/api`

### 2. **–°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö (Scraping)**

Prometheus **—Å–∞–º –æ–ø—Ä–∞—à–∏–≤–∞–µ—Ç (pull)** endpoints (–≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç push-–º–æ–¥–µ–ª–µ–π).  
–°–µ—Ä–≤–∏—Å—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç endpoint `/metrics`, –≥–¥–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç –º–µ—Ç—Ä–∏–∫–∏ –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ.

–ü—Ä–∏–º–µ—Ä:

```
# HELP http_requests_total Total number of HTTP requests
# TYPE http_requests_total counter
http_requests_total{method="GET"} 1042
```

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **Pushgateway**, —á—Ç–æ–±—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑ –∫—Ä–∞—Ç–∫–æ–∂–∏–≤—É—â–∏—Ö job‚Äô–æ–≤).

### 3. **Exporters**

Exporters ‚Äî —ç—Ç–æ –ø—Ä–æ–≥—Ä–∞–º–º—ã, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–±–∏—Ä–∞—é—Ç –º–µ—Ç—Ä–∏–∫–∏ –∏–∑ –≤–Ω–µ—à–Ω–∏—Ö —Å–∏—Å—Ç–µ–º –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç –∏—Ö –≤ —Ñ–æ—Ä–º–∞—Ç–µ Prometheus.  
–ü—Ä–∏–º–µ—Ä—ã –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö exporters:

|Exporter|–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ|
|---|---|
|**node_exporter**|–°–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (CPU, RAM, –¥–∏—Å–∫–∏, —Å–µ—Ç—å)|
|**blackbox_exporter**|–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ (ping, HTTP, TCP, DNS)|
|**mysqld_exporter**|–ú–µ—Ç—Ä–∏–∫–∏ MySQL|
|**kube-state-metrics**|–ú–µ—Ç—Ä–∏–∫–∏ Kubernetes –æ–±—ä–µ–∫—Ç–æ–≤|
|**cadvisor**|–ú–µ—Ç—Ä–∏–∫–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ Docker|
### 4. **PromQL**

Prometheus –∏–º–µ–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —è–∑—ã–∫ –∑–∞–ø—Ä–æ—Å–æ–≤ ‚Äî **PromQL (Prometheus Query Language)**.  
–û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç:

- —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –ø–æ label‚Äô–∞–º,
- –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å –ø–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º,
- —Å—Ç—Ä–æ–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏ –∏ –∞–ª–µ—Ä—Ç—ã.

 –ü—Ä–∏–º–µ—Ä—ã:

```promql
rate(http_requests_total[5m])          # —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–æ—Å—Ç–∞ –º–µ—Ç—Ä–∏–∫–∏ –∑–∞ 5 –º–∏–Ω—É—Ç
sum(rate(http_requests_total[5m])) by (method)
avg(node_cpu_seconds_total{mode="idle"}) by (instance)
```

### 5. **Alerting**

Prometheus –≤–∫–ª—é—á–∞–µ—Ç **Alertmanager** ‚Äî –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–ø–æ–≤–µ—â–µ–Ω–∏—è–º–∏.

–ü—Ä–æ—Ü–µ—Å—Å:

1. Prometheus –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –∞–ª–µ—Ä—Ç–æ–≤ (–∏–∑ `.rules` —Ñ–∞–π–ª–æ–≤).
2. –ü—Ä–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–∏ ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ –≤ Alertmanager.
3. Alertmanager –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç (–≥—Ä—É–ø–ø–∏—Ä—É–µ—Ç, –ø–æ–¥–∞–≤–ª—è–µ—Ç) –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: Slack, Email, Telegram, PagerDuty –∏ —Ç.–¥.

 –ü—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∏–ª–∞:

```yaml
groups:
  - name: instance_down
    rules:
      - alert: InstanceDown
        expr: up == 0
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "–ò–Ω—Å—Ç–∞–Ω—Å {{ $labels.instance }} –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
```

##  –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Prometheus

```
          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
          ‚îÇ Exporters  ‚îÇ
          ‚îÇ App / Node ‚îÇ
          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ (HTTP /metrics)
                ‚ñº
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ Prometheus     ‚îÇ
         ‚îÇ  - Scraping    ‚îÇ
         ‚îÇ  - Storage     ‚îÇ
         ‚îÇ  - PromQL API  ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ
                ‚îú‚îÄ‚îÄ‚ñ∫ Grafana (–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è)
                ‚îî‚îÄ‚îÄ‚ñ∫ Alertmanager (–æ–ø–æ–≤–µ—â–µ–Ω–∏—è)
```

##  –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã Prometheus

|–ö–æ–º–ø–æ–Ω–µ–Ω—Ç|–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ|
|---|---|
|**Prometheus Server**|–û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä: —Å–æ–±–∏—Ä–∞–µ—Ç, —Ö—Ä–∞–Ω–∏—Ç, –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –º–µ—Ç—Ä–∏–∫–∏|
|**Alertmanager**|–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏|
|**Pushgateway**|–ü—Ä–∏—ë–º push-–º–µ—Ç—Ä–∏–∫|
|**Exporters**|–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –º–µ—Ç—Ä–∏–∫|
|**Grafana**|–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö|
|**Promtool**|–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –∏ –ø—Ä–∞–≤–∏–ª|

##  –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

- –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è **time-series database (TSDB)**, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–æ–¥ –º–µ—Ç—Ä–∏–∫–∏.
- –ú–µ—Ç—Ä–∏–∫–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –Ω–∞ –¥–∏—Å–∫–µ –≤ –≤–∏–¥–µ –±–ª–æ–∫–æ–≤ (~2 —á–∞—Å–∞ –∫–∞–∂–¥—ã–π).
- Retention period –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è (`--storage.tsdb.retention.time`).
- –î–ª—è –¥–æ–ª–≥–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è ‚Äî –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **remote_write** (Thanos, VictoriaMetrics, Cortex, Mimir).

##  Prometheus –∏ Kubernetes

Prometheus –æ—Ç–ª–∏—á–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å [[Kubernetes]]:

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤ —á–µ—Ä–µ–∑ **service discovery**.
- –ú–µ—Ç—Ä–∏–∫–∏ –æ—Ç kubelet, API-server, pods, –∏ –¥—Ä—É–≥–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.
- –ß–∞—Å—Ç–æ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤ —Å–æ—Å—Ç–∞–≤–µ **Prometheus Operator** ‚Äî –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Prometheus —á–µ—Ä–µ–∑ CRD (Custom Resource Definitions).

 –ü—Ä–∏–º–µ—Ä ServiceMonitor (–¥–ª—è Operator):

```yaml
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: my-app
spec:
  selector:
    matchLabels:
      app: my-app
  endpoints:
    - port: http
      path: /metrics
      interval: 15s
```

##  Grafana + Prometheus

[[Grafana]] –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ Prometheus –∫–∞–∫ **data source** –∏ –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –≤–∏–¥–µ –¥–∞—à–±–æ—Ä–¥–æ–≤.  
##  –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Prometheus

‚úÖ Open source –∏ Cloud Native  
‚úÖ –ü—Ä–æ—Å—Ç–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞  
‚úÖ Pull-–º–æ–¥–µ–ª—å (–∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö)  
‚úÖ –ú–æ—â–Ω—ã–π —è–∑—ã–∫ PromQL  
‚úÖ –®–∏—Ä–æ–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ exporter‚Äô–æ–≤  
‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Kubernetes –∏ Grafana

##  –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏

‚öôÔ∏è –ù–µ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –ª–æ–≥–æ–≤ (—Ç–æ–ª—å–∫–æ –º–µ—Ç—Ä–∏–∫–∏)  
üì¶ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –¥–æ–ª–≥–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö —Ä–µ—à–µ–Ω–∏–π  
üåê –ù–µ—Ç –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑ –∫–æ—Ä–æ–±–∫–∏ (—Ç—Ä–µ–±—É–µ—Ç—Å—è Thanos/Cortex)

##  –ü—Ä–∏–º–µ—Ä –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ `prometheus.yml`

```yaml
global:
  scrape_interval: 15s

scrape_configs:
  - job_name: "prometheus"
    static_configs:
      - targets: ["localhost:9090"]

  - job_name: "node"
    static_configs:
      - targets: ["node-exporter:9100"]
```
