
**Kubernetes (K8s)** — это оркестратор контейнеров.  Его задача: Автоматически запускать, масштабировать, обновлять и восстанавливать контейнеризированные приложения.

Kubernetes управляет:
- состоянием приложений,
- ресурсами кластера,
- сетью и доступами,
- распределением нагрузки.

#  **Главные возможности Kubernetes**

### 1. **Оркестрация контейнеров**

Запуск, перезапуск, распределение подов по нодам.

### 2. **Self-healing**

K8s автоматически:

- перезапустит упавший контейнер,
- пересоздаст pod, если он умер,
- перенесёт pod, если нода недоступна,
- приведёт кластер к желаемому состоянию.

### 3. **Scalability (масштабирование)**

- вертикальное (ресурсы)
- горизонтальное (копии)
- автоскейлинг по нагрузке (HPA/VPA)

### 4. **Service Discovery / Networking**

- внутренняя сеть между сервисами,
- балансировка нагрузки,
- DNS внутри кластера.

### 5. **Rolling Updates / Rollbacks**

K8s разворачивает новую версию без даунтайма и откатывает при ошибках.

### 6. **Declarative Infrastructure**

Всё описано манифестами YAML.  
Желаемое состояние задаётся, а Kubernetes приводит факт к этому состоянию.

#  **Архитектура Kubernetes**

##  **Control Plane (управляющая плоскость)**

### **1. API Server**

Главная точка входа.  
kubectl → API → cluster.

### **2. Scheduler**

Выбирает, на какую ноду посадить pod.

### **3. Controller Manager**

Контроллеры:

- ReplicaSet
- Deployment
- Node controller
- Endpoint controller  
    и т.д.

### **4. etcd**

СУБД, хранящая всё состояние кластера.


##  **Worker Nodes (рабочие ноды)**

На каждой:
### **1. kubelet**

Агент, который запускает контейнеры и следит за подами.
### **2. Container runtime**

Например:

- containerd
- CRI-O

### **3. kube-proxy**

Сетевой прокси, реализующий сервисы и iptables/ipvs.

#  **Основные объекты Kubernetes**

Работа в K8s — это работа с объектами API.
##  **Pod**

Минимальная единица — один или несколько контейнеров с общим IP/FS.
##  **ReplicaSet**

Следит за количеством одинаковых pod.
##  **Deployment**

Самый популярный объект для приложений.

Даёт:

- rollout (плавное обновление),
- rollback,
- управление версиями,
- декларативность.
##  **StatefulSet**

Для stateful-приложений (БД, Kafka, Redis Cluster).  
Даёт:

- стабильные DNS имена,
- постоянный порядок (ordinal),
- привязку к volume.
##  **DaemonSet**

Под на каждой ноде.  
Используется для:

- логирования (Fluentd),
- мониторинга (Prometheus node exporter),
- сетевых агентов.
##  **Job / CronJob**

Один запуск или периодические задачи.
##  **Service**

Доступ к pod’ам. Типы:

- ClusterIP (внутренний)
- NodePort (наружу через порты нод)
- LoadBalancer (наружу через облачный LB)
- Headless (для StatefulSet)
##  **Ingress**

Маршрутизация HTTP/HTTPS трафика.  
Реализуется контроллером:

- Nginx Ingress
- Traefik
- HAProxy
- Istio Gateway
##  **ConfigMap**

Конфигурации (не чувствительные).
##  **Secret**

Конфиденциальные данные (base64, часто шифруются сверху).
##  **PersistentVolume (PV)**

Указатель на реальное хранилище.
##  **PersistentVolumeClaim (PVC)**

Запрос хранилища от приложения.
##  **StorageClass**

Шаблон для динамического провижининга дисков.
#  **Networking в Kubernetes**

## Внутри кластера выполняется 3 правила:

✅ pod → pod без NAT  
✅ каждый pod имеет свой IP  
✅ сервисы получают стабильные виртуальные IP

Используются CNI-плагины:

- Calico
- Flannel
- Cilium
- Weave Net

#  **GitOps и CD**

Для CD чаще всего используют:

- **Argo CD**
- **Flux**

Они следят за Git-репозиторием и автоматически приводят кластер к нужному состоянию.

#  **Безопасность K8s**

Основные механизмы:
### RBAC

Разрешения пользователей/ сервисов.
### Network Policies

Правила трафика между pod'ами.
### Pod Security Standards / Admission

Ограничение привилегий контейнеров.
### Secrets (внешние)

Vault, Sealed Secrets, ESO.

#  **Популярные аддоны**

### Мониторинг

- Prometheus + Grafana
- Loki / Fluentd для логов
### Service Mesh

- Istio
- Linkerd
- Kuma

### Автоскейлинг

- HPA (по CPU/пользовательским метрикам)
- VPA (ресурсы)
- Cluster Autoscaler (нод)

#  **Где используется Kubernetes**

- Облака: GKE, EKS, AKS
- On-premises: bare metal, VMware
- Edge computing
- GitLab/GitHub runners
- Big data нагрузки
- Микросервисы и event-driven архитектуры

#  **Плюсы и минусы Kubernetes**

###  Плюсы:

- масштабируемость,
- отказоустойчивость,
- стандартизация,
- гибкость,
- мультикластерность,
- большой экосистемный выбор.

### ❌ Минусы:

- крутая кривая обучения,
- избыточность для маленьких проектов,
- сложность сетей и безопасности,
- ресурсозатраты.

